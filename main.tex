\documentclass[12pt,onecolumn,a4paper]{article}
\usepackage{amsthm,amsmath,amssymb,bm}
\usepackage{epsfig,graphicx,subcaption}
\usepackage{float}
\usepackage{color,xcolor}
\usepackage{fmtcount}
\usepackage{placeins}
\usepackage{adjustbox}
\usepackage{tikz}
\usepackage{csvsimple}
\usepackage[top=1in, left=1in, right=1in, bottom=1in]{geometry}
\usepackage{nicefrac}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{tabularx, booktabs, makecell}
\usepackage{hyperref,url}
\usepackage{listings}

\makeatletter
\let\old@lstKV@SwitchCases\lstKV@SwitchCases
\def\lstKV@SwitchCases#1#2#3{}
\makeatother
\usepackage{lstlinebgrd}
\makeatletter
\let\lstKV@SwitchCases\old@lstKV@SwitchCases

\lst@Key{numbers}{none}{%
	\def\lst@PlaceNumber{\lst@linebgrd}%
	\lstKV@SwitchCases{#1}%
	{none:\\%
		left:\def\lst@PlaceNumber{\llap{\normalfont
				\lst@numberstyle{\thelstnumber}\kern\lst@numbersep}\lst@linebgrd}\\%
		right:\def\lst@PlaceNumber{\rlap{\normalfont
				\kern\linewidth \kern\lst@numbersep
				\lst@numberstyle{\thelstnumber}}\lst@linebgrd}%
	}{\PackageError{Listings}{Numbers #1 unknown}\@ehc}}
\makeatother
\newcounter{subListing}[subfigure]

\lstset{language=matlab,%
	%backgroundcolor=\color{gray!10},
	basicstyle=\tt\scriptsize,
	frame = LBtr,
	%frameround=T,
	rulecolor=\color{gray},
	showstringspaces=false,
	numbers=left,%
	numberstyle={\tiny\color{gray}},
	numbersep=8pt,
	breaklines=true,
	%postbreak=\mbox{\textcolor{yellow}{$\hookrightarrow$}\space},
	tabsize=2,
	escapechar=`,
	xleftmargin=1.8 em, 
	framexleftmargin=2em,
}

\newcommand*{\transpose}{{\mkern-1.5mu\mathsf{T}}}


\usepackage{titlesec}
\titleformat{\section}[block]
{\titlerule\addvspace{4pt}\normalfont\fontsize{14}{16}\bfseries}
{\thesection\enspace}{0pt}{}[\vspace{2pt}\titlerule]


\newcommand\question{
	\section{Question \numberstringnum{\thesection}}
}


\author{Mohammad Raziei}
\title{Solutions to the First Series of Exercises}
\date{\today}




\newcounter{rownum} % Define a counter for the row number
\begin{document}
	
	
	% Set the page style to "fancy"...
	\pagestyle{fancy}
	%... then configure it.
	%		\fancyhead{} % clear all header fields
	%		\fancyhead[RO,LE]{\textbf{The performance of new graduates}}
	%		\fancyfoot{} % clear all footer fields
	%		\fancyfoot[LE,RO]{\thepage}
	%		\fancyfoot[LO,CE]{From: K. Grant}
	%		\fancyfoot[CO,RE]{To: Dean A. Smith}
	\maketitle
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\FloatBarrier\question%1
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	\subsection{part a, b:}
	
	We solve the first and second parts together due to their high similarity. The figure below shows the shape of these two parts.
	
		\begin{figure}[h]
		
		\begin{subfigure}{\linewidth}
			\centering
			\begin{adjustbox}{scale=1.2}
				\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
					\def\dscale{1}
					\setcounter{rownum}{1} % Initialize the counter
					\foreach \vertexold/\vertex in {0/0, 0/1, 1/4, 4/6} {
						\node[draw,circle,fill=black, inner sep=2pt,line width=.7] (\vertex) at (\dscale*\vertex, 0) {};
						\node[above, gray] at (\vertex) {\arabic{rownum}};
						
						% Draw a line and add the difference label if vertexold is less than vertex
						\ifnum\vertexold<\vertex
						\pgfmathsetmacro\difference{\vertex - \vertexold} % Calculate the difference
						
						% Format the output based on whether it is an integer or not
						% Format the output based on whether it is an integer or not
						\pgfmathsetmacro\differenceDisplay{int(\difference) == \difference ? int(\difference) : \difference}
						
						% Decide on what to display
						\pgfmathsetmacro\displayText{\differenceDisplay == 1 ? "" : \differenceDisplay}
						
						
						% Draw the line and display the difference
						\draw (\vertexold) -- (\vertex) node[midway, below, red] {$\displayText d$};
						\fi
						\stepcounter{rownum}
					}
				\end{tikzpicture}
			\end{adjustbox}
			\caption{4-element perfect array}
		\end{subfigure}
		
		\vspace{1.5em}
		
		\begin{subfigure}{\linewidth}
			\centering
			\begin{adjustbox}{scale=1.2}
				\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
					\def\dscale{1}
					\setcounter{rownum}{1} % Initialize the counter
					\foreach \vertexold/\vertex in {0/0, 0/1, 1/2, 2/3, 3/4, 4/5, 5/6} {
						\node[draw,circle,fill=black, inner sep=2pt,line width=.7] (\vertex) at (\dscale*\vertex, 0) {};
						\node[above, gray] at (\vertex) {\arabic{rownum}};
						% Draw a line and add the difference label if vertexold is less than vertex
						\ifnum\vertexold<\vertex
						\pgfmathsetmacro\difference{\vertex - \vertexold} % Calculate the difference
						
						% Format the output based on whether it is an integer or not
						% Format the output based on whether it is an integer or not
						\pgfmathsetmacro\differenceDisplay{int(\difference) == \difference ? int(\difference) : \difference}
						
						% Decide on what to display
						\pgfmathsetmacro\displayText{\differenceDisplay == 1 ? "" : \differenceDisplay}
						
						
						% Draw the line and display the difference
						\draw (\vertexold) -- (\vertex) node[midway, below, red] {$\displayText d$};
						\fi
						\stepcounter{rownum}
					}
				\end{tikzpicture}
			\end{adjustbox}
			\caption{7-element regular linear array}
		\end{subfigure}
		\caption{linear arrays}
	\end{figure}
	
	In this figure, d is half the wavelength, i.e.:	
	\begin{equation}
		\frac{d}{\lambda} = \nicefrac12
	\end{equation}
	
	On the other hand, we know that the array factor for a linear array with equal spacing is obtained from the following equation:	
	\begin{equation}
		\mathrm{AF}(\theta) = \sum_{n} w_n \mathrm{e}^{-\mathrm{j}n(\frac{d}{\lambda}2\pi\cos(\theta))}
	\end{equation}
	
	This equation can be implemented in MATLAB as follows:
\begin{lstlisting}
AF_theta =@(w_n, d_lambda, theta_0) w_n * exp(1j*(0:length(w_n)-1).'* (2*pi*d_lambda * cos(theta_0)));
AF = @(w_n, d_lambda, theta) arrayfun(@(theta_0) AF_theta(w_n, d_lambda, theta_0), theta,'UniformOutput',true);
\end{lstlisting}
	
In this equation, using \texttt{w\_n}, we can solve both part (a) and part (b). For part (b), it is sufficient to consider \texttt{w\_n} as an \textit{all-ones} vector. However, for part (a), this vector is sparse and is defined as follows:
\begin{lstlisting}
w_n = [1, 1, 0, 0, 1, 0, 1];
\end{lstlisting}
Note that \verb|sum(w_n)| is equal to the number of elements in the array.
The diagrams of these two array factors are presented in Figures \ref{fig:af-plot} and \ref{fig:af-polarplot}.

	\begin{figure}[h]
		\begin{subfigure}{.48\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q1/results/AF-plot}
			\caption{value scale}
			\label{fig:af-plot-value}
		\end{subfigure}
		\hfill
		\begin{subfigure}{.48\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q1/results/AF-plot-logy}
			\caption{log scale}
			\label{fig:af-plot-logy}
		\end{subfigure}
		\caption{
			Array factor diagram as a function of the angle $\theta$.
			The red line corresponds to part a, and the black line corresponds to part b.
		}
		\label{fig:af-plot}
	\end{figure}
	
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=.6\linewidth]{Q1/results/AF-polarplot}
		\caption{
			Array factor polar diagram as a function of the angle $\theta$.
		The red line corresponds to part a, and the black line corresponds to part b.
		}
		\label{fig:af-polarplot}
	\end{figure}
	
	
	To find the BWNN, we analyze the diagrams in Figure \ref{fig:af-plot-value} separately and identify their zeros. We then determine the BWNN value based on this analysis. To find the zeros, we use the findpeaks function in MATLAB. All values are displayed in Figures \ref{fig:af-plot-localmaxmin-a} and \ref{fig:af-plot-localmaxmin-b}.
	
	
	
	\begin{figure}
		\centering
		\begin{subfigure}{\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q1/results/AF-plot-localmaxmin-a}
			\caption{}
			\label{fig:af-plot-localmaxmin-a}
		\end{subfigure}
		
		\begin{subfigure}{\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q1/results/AF-plot-localmaxmin-b}
			\caption{}
			\label{fig:af-plot-localmaxmin-b}
		\end{subfigure}
		
		\caption{
			\space
		}
	\end{figure}
	
	
	\begin{equation}
		\text{BWNN}_a = 0.14\pi \qquad, \qquad \text{BWNN}_b = 0.18\pi
	\end{equation}
	
	
	As can be seen from the diagram, the main lobe of both structures is aligned at $\theta = \nicefrac{\pi}{2}$. However, in the uniform linear array (ULA), more power is concentrated in the direction of $\theta = \nicefrac{\pi}{2}$. The side lobes of the ULA structure are much smaller than those of the perfect array structure, and the side lobe level in the ULA structure is significantly higher than in the perfect array structure. Nevertheless, it should be noted that the overall pattern of the perfect array is acceptable, and in terms of physical structure, it uses fewer antenna elements than the ULA structure, which results in cost savings in antenna manufacturing.
	
	
	
	\subsection{part c:}
	These two patterns do not differ significantly in terms of bandwidth, so it can be concluded that their bandwidth is not a function of the number of elements but depends on the array size. However, naturally, in the ULA case, due to having more elements, it provides higher gain and better SLL.
	However, in the perfect array, we have managed to create a similar pattern with fewer elements.
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\FloatBarrier\question%2
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	\FloatBarrier
	\subsection{part a:}
	According to the data from the csv file, the resolution of the antenna radiation pattern in the directions of $\theta$ and $\phi$ is 2 degrees and the range of variation for $\phi$ is between 0 to 360, and for $\theta$ is between -180 to 180.
	
	
	
	
	
	
	
	\FloatBarrier
	\subsection{part b:}
	
	We import the data from the csv file into MATLAB and plot the 3D radiation pattern of the antenna in Figure~\ref{fig:2d-3d-plot-angles}.
	
	
	
	
	
	\begin{figure}[h]
		\centering
		\begin{subfigure}{.43\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q2/results/2d-plot-angles}
			\caption{2D pattern using \texttt{imagesc} function}
			\label{fig:2d-plot-angles}
		\end{subfigure}
		\hfill
		\begin{subfigure}{.5\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q2/results/3d-plot-angles}
			\caption{3D pattern using \texttt{surf} function}
			\label{fig:3d-plot-angles}
		\end{subfigure}
		\caption{Antenna radiation pattern in the $\phi-\theta$ plane}
		\label{fig:2d-3d-plot-angles}
	\end{figure}
	
	For better visualization, we plot this pattern in Cartesian space. Figure~\ref{fig:spatial-antenna-pattern} illustrates this spatial visualization.
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.7\linewidth]{Q2/results/spatial-antenna-pattern}
		\caption{Spatial antenna pattern in Cartesian space}
		\label{fig:spatial-antenna-pattern}
	\end{figure}
		
	
	\FloatBarrier
	\subsection{part c:}
	
	Now, we set $\phi$ to zero and determine the antenna characteristics (peak gain, HPBW, null level, and side lobe level).
	
	
	In the first step, we plot the antenna pattern at $\phi=0$ in polar coordinates. Figure~\ref{fig:phi0-polar} illustrates this.
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.4\linewidth]{Q2/results/phi0-polar}
		\caption{Antenna pattern at $\phi = 0$}
		\label{fig:phi0-polar}
	\end{figure}
	
	
	Now, we find the peak and null points, as well as the intersection of the function with the linear axis that is 3 dB below the maximum. Figure~\ref{fig:phi0} displays all the desired characteristics of the antenna.
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=\linewidth]{Q2/results/phi0}
		\caption{Calculating the half-power beam-width in the $\phi = 0^\circ$ plane}
		\label{fig:phi0}
	\end{figure}
	
	
	\begin{table}[H]
		\centering
		\caption{antenna characteristics at $\phi = 0$}
		{\scriptsize
		\begin{tabular}{cccccc}
			\toprule
			\textbf{HPBW} & \textbf{BWNN} & \textbf{left Side-Lobe-Level} &  \textbf{left null-Level} & \textbf{right Side-Lobe-Level} & \textbf{right null-Level} \\
			\midrule
			$46^\circ$ & $282^\circ$ & $16.4\, dB$ & $-11.2\, dB$ & $14.7\, dB$ & $-14.88\, dB$
			\\
			\bottomrule
		\end{tabular}}
	\end{table}
	
	Therefore, in the worst case, the SLL value is $-14.7\, dB$.
	
	
	
	\FloatBarrier
	\subsection{part d:}
	
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.4\linewidth]{Q2/results/phi90-polar}
		\caption{}
		\label{fig:phi90-polar}
	\end{figure}
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=\linewidth]{Q2/results/phi90}
		\caption{}
		\label{fig:phi90}
	\end{figure}
	
	
	
	\FloatBarrier
	\subsection{part e:}
	
	
	Mutual coupling in antennas refers to the interaction between two or more antennas that are placed in close proximity to each other. This phenomenon occurs due to the electromagnetic fields radiated by one antenna affecting the currents and fields in the nearby antennas. It can impact the performance of antenna arrays and systems.
	
	The presence of mutual coupling can alter the combined radiation pattern of the antennas, deviating from the intended directionality or beam shape.
	As seen in Figure~\ref{fig:spatial-antenna-pattern}, mutual coupling has caused distortion in the spatial pattern.
	\FloatBarrier
	\subsection{part f:}
	
	We know that the array factor can be written as follows:
	
	\begin{equation}
		|\text{AF}| = |\text{AF}_p| \times |\text{AF}_{xy}|
	\end{equation}
	
	Where $AF_p$ is the antenna pattern presented in Figures \ref{fig:2d-3d-plot-angles} and \ref{fig:spatial-antenna-pattern}, and $AF_{xy}$ is the desired $4\times4$ antenna pattern.
	
	To calculate the $4\times4$ antenna pattern, we first form the position vector $\bm{p}$ and the wave number vector $\bm{k}$:
	\begin{equation}
		\bm{k} = \frac{2\pi}{\lambda} 
		\begin{bmatrix}
			\sin(\theta) \cos(\phi) \\
			\sin(\theta) \sin(\phi) \\
			\cos(\theta)
		\end{bmatrix}
	\end{equation}
	and,
	\begin{equation}
		\bm{p}_{n,m} = 
		\begin{bmatrix}
			n d_x \\
			m d_y \\
			0
		\end{bmatrix}
		; \quad n, m \in \big\{  0, \ldots, N - 1 \big\}
	\end{equation}
	
	Now, we can write:
\begin{align}
	\text{AF}_{xy} &= \sum_{\ell=0}^{N-1} \sum_{q=0}^{N-1} w_{\ell,q} \, \mathrm{e}^{\mathrm{j} \, \bm{k}^\transpose \bm{p}_{\ell,q}}\\
	&= \sum_{\ell=0}^{3} \sum_{q=0}^{N-1} \mathrm{e}^{\frac{2\pi}{\lambda} \left( \mathrm{j} \, \ell \, d_x \, \sin(\theta) \cos(\phi) + \mathrm{j} \, q \, d_y \, \sin(\theta) \sin(\phi) \right)} \\
	&= \sum_{\ell=0}^{N-1} \sum_{q=0}^{N-1} \mathrm{e}^{\frac{2\pi}{\lambda} \, \mathrm{j} \, \ell \, d_x \, \sin(\theta) \cos(\phi)} \, \mathrm{e}^{\frac{2\pi}{\lambda} \, \mathrm{j} \, q \, d_y \, \sin(\theta) \sin(\phi)} \\
	&= \sum_{\ell=0}^{N-1} \mathrm{e}^{\frac{2\pi}{\lambda} \, \mathrm{j} \, \ell \, d_x \, \sin(\theta) \cos(\phi)} \, \sum_{q=0}^{N-1} \mathrm{e}^{\frac{2\pi}{\lambda} \, \mathrm{j} \, q \, d_y \, \sin(\theta) \sin(\phi)} \\
	\implies |\text{AF}_{xy}| &= 
	\frac{\sin \left( \frac{N-1}{2} \, \frac{2\pi}{\lambda} \, d_x \, \sin(\theta) \cos(\phi) \right)}
	{\sin \left( \frac{1}{2} \, \frac{2\pi}{\lambda} \, d_x \, \sin(\theta) \cos(\phi) \right)} 
	\cdot
	\frac{\sin \left( \frac{N-1}{2} \, \frac{2\pi}{\lambda} \, d_y \, \sin(\theta) \sin(\phi) \right)}
	{\sin \left( \frac{1}{2} \, \frac{2\pi}{\lambda} \, d_y \, \sin(\theta) \sin(\phi) \right)}
\end{align}

The above equation can be decomposed as follows:
	\begin{equation}
			|\text{AF}_{xy}| = |\text{AF}_x| \times |\text{AF}_y|,
	\end{equation}
	
where $|\text{AF}_x|$ is the array factor in the x-direction, which is defined as follows:
	\begin{equation}
		|\text{AF}_x| = 
		\frac{\sin \left( ({N-1}) \, \frac{\pi}{\lambda} \, d_y \, \sin(\theta) \cos(\phi) \right)}
		{\sin \left( \, \frac{\pi}{\lambda} \, d_y \, \sin(\theta) \cos(\phi) \right)},
	\end{equation}
	
	and similarly, for $|\text{AF}_y|$ in the y-direction, we have:
	\begin{equation}
		|\text{AF}_y| = 
		\frac{\sin \left( ({N-1}) \, \frac{\pi}{\lambda} \, d_y \, \sin(\theta) \sin(\phi) \right)}
		{\sin \left( \, \frac{\pi}{\lambda} \, d_y \, \sin(\theta) \sin(\phi) \right)}.
	\end{equation}

	Note that in this case, the value of $N$ is 4.
	Now, $|\text{AF}| $ can be decomposed as follows:
	\begin{equation}
		|\text{AF}| = |\text{AF}_p| \times |\text{AF}_x| \times |\text{AF}_y|
	\end{equation}
	
	
	\begin{equation}
		\operatorname{db}(|\text{AF}|) = \operatorname{db}(|\text{AF}_p|) + \operatorname{db}(|\text{AF}_x|) + \operatorname{db}(|\text{AF}_y|)
	\end{equation}
	
	
	\begin{equation}
		\lambda = \frac{c}{f_0} = \frac{3 \times 10^8}{60.48 \times 10^9} = 0.00496 \, (\mathrm{m}) = 4.96 \, (\mathrm{mm})
	\end{equation}

\begin{figure}[H]
		\begin{subfigure}{.5\linewidth}
		\centering
		\includegraphics[width=\linewidth]{Q2/results/3d-plot-angles-4x4}
		\caption{3D plot using \texttt{surf}}
		\label{fig:3d-plot-angles-4x4}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.5\linewidth}
		\centering
		\includegraphics[width=\linewidth]{Q2/results/2d-plot-angles-4x4}
		\caption{2D plot using \texttt{imagesc}}
		\label{fig:2d-plot-angles-4x4}
	\end{subfigure}
	\caption{$|\text{AF}_{xy}|$ in dB scale}
\end{figure}
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{Q2/results/spatial-antenna-pattern-4x4}
		\caption{$|\text{AF}_{xy}|$ spatial antenna pattern in magnitude scale}
		\label{fig:spatial-antenna-pattern-4x4}
	\end{figure}

	
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Q2/results/3d-plot-angles-4x4-total}
	\caption{}
	\label{fig:3d-plot-angles-4x4-total}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Q2/results/spatial-antenna-pattern-4x4-total}
	\caption{}
	\label{fig:spatial-antenna-pattern-4x4-total}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{Q2/results/2d-plot-angles-4x4-total}
	\caption{}
	\label{fig:2d-plot-angles-4x4-total}
\end{figure}


	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\FloatBarrier
	\question%3
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	
	\FloatBarrier
	\subsection{part a:}
	As evident from the .csv file data, its frequency range is within 50 GHz to 70 GHz.
	
	
	
	\FloatBarrier
	\subsection{part b:}
	
	In the .csv file, there are four columns corresponding to the parameters $S_{21}$, $S_{12}$, $S_{11}$, and $S_{22}$. 

	\begin{itemize}
		\item The $S_{11}$ parameter indicates how much power is reflected if the power is supplied from the first port to the antenna. 
		In other words, it is a measure of the matching between the transmission line and the first port. 
		\item The $S_{22}$ parameter indicates how much power is reflected if the power is supplied from the second port to the antenna. 
		This parameter is also a measure of the matching between the transmission line and the second port. 
		\item The $S_{12}$ parameter indicates how much power is transferred from the first port to the second port when power is supplied from the first port to the antenna. 
		\item Similarly, the $S_{21}$ parameter indicates how much power is transferred from the second port to the first port when power is supplied from the second port to the antenna. 
	\end{itemize}

	We import the .csv file data into MATLAB and plot all the $S$ parameters in Figure~\ref{fig:S-parametes}. 
	As evident from Figure~\ref{fig:S-parametes}, the $S_{11}$ and $S_{22}$ curves are similar, and the $S_{12}$ and $S_{21}$ curves are also similar. 
	This similarity is due to the passive nature of the antenna structure.
	
	
	\begin{figure}[H]
		\centering
		\begin{subfigure}{.45\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q3/results/s11}
			\caption{$S_{11}$}
			\label{fig:s11}
		\end{subfigure}
		\hfill
		\begin{subfigure}{.45\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q3/results/s12}
			\caption{$S_{12}$}
			\label{fig:s12}
		\end{subfigure}
		
		\begin{subfigure}{.45\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q3/results/s21}
			\caption{$S_{21}$}
			\label{fig:s21}
		\end{subfigure}
		\hfill
		\begin{subfigure}{.45\linewidth}
			\centering
			\includegraphics[width=\linewidth]{Q3/results/s22}
			\caption{$S_{22}$}
			\label{fig:s22}
		\end{subfigure}
		\caption{$S$-parameters}
		\label{fig:S-parametes}
	\end{figure}	
	
	
	
	\begin{figure}[H]
	\centering
	\includegraphics[width=.5\linewidth]{Q3/results/S-param}
	\caption{$S$-parameters}
	\label{fig:S-param}
	\end{figure}


	
	\FloatBarrier
	\subsection{part c:}
	
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=.5\linewidth]{Q3/results/s11-10db}
		\caption{10db-Band Width}
		\label{fig:s11-10db}
	\end{figure}
	
	\begin{table}[H]
		\centering
		\begin{tabular}{cc}
			\toprule
			\textbf{-10 dB impedance band-width (BW)} & 10.2 \\ \midrule		
			\textbf{Fractional band-width} & 0.1659 \\ \midrule
			\textbf{Center frequency ($f_0$)}                & 61.5   \\ 
			\bottomrule
		\end{tabular}
	\end{table}
	
	
	\FloatBarrier
	\subsection{part d:}
	
	
		\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{Q3/results/s12-f0}
		\caption{$S_{12}$ parameter at the center frequency}
		\label{fig:s12-f0}
	\end{figure}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\FloatBarrier
	\question%4
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	

	\begin{equation}
		f_0 = 60 \times 10^9 Hz
	\end{equation}
	
	\begin{equation}
		\lambda_0 = \frac{c}{f_0} = \frac{3 \times 10^8}{60 \times 10^9} = 5 \times 10^{-3}\ (m) = 5\ (mm)
	\end{equation}
	
	
	\FloatBarrier
	\subsection{part a:}
	
	\begin{equation}
		R_1 = (2.5 \times 10^{-3}) 
		\begin{bmatrix}
			3 & 0 & 0 \\
			2 & 0 & 0 \\
			1 & 0 & 0 \\
			0 & 0 & 0 \\
			-1 & 0 & 0 \\
			-2 & 0 & 0 \\
			-3 & 0 & 0
		\end{bmatrix}
		=
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/R1.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
	\end{equation}
	
	\begin{equation}
		d = 2.5 \times 10^{-3} = \frac{\lambda_0}2
	\end{equation}
	
	
	\begin{figure}[h]
		\centering
		\begin{adjustbox}{scale=1.2}
			\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
				\def\dscale{300} % Set the scaling factor to 300
				\setcounter{rownum}{1} % Initialize the counter
				\coordinate (o) (0,0);		
				\csvreader[head=false]{Q4/results/R1.csv}{}%
				{%
					% Draw the node at the scaled position
					\node[draw, circle, fill=black, inner sep=2pt, line width=.7] 
					(\arabic{rownum}) at (\csvcoli*\dscale, \csvcolii*\dscale) {};
					% Add the row number above each node
					\node[above, gray] at (\arabic{rownum}) {\arabic{rownum}};
					\draw (o) -- (\arabic{rownum});
					\stepcounter{rownum} % Increment the counter after each row
				}%
			\end{tikzpicture}
		\end{adjustbox}
		\caption{\space}
	\end{figure}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.5\linewidth]{Q4/results/array-beam-polar-R1}
		\caption{}
		\label{fig:array-beam-polar-r1}
	\end{figure}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=\linewidth]{Q4/results/array-beam-R1}
		\caption{}
		\label{fig:array-beam-r1}
	\end{figure}
	
	
	\FloatBarrier
	\subsection{part b:}
	
	\begin{equation}
		R_2 = (5 \times 10^{-3}) 
		\begin{bmatrix}
			3 & 0 & 0 \\
			2 & 0 & 0 \\
			1 & 0 & 0 \\
			0 & 0 & 0 \\
			-1 & 0 & 0 \\
			-2 & 0 & 0 \\
			-3 & 0 & 0
		\end{bmatrix}
		=
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/R2.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
	\end{equation}
	
	
	
	\begin{equation}
		d = 5 \times 10^{-3} = \lambda_0
	\end{equation}
	
%	\begin{adjustbox}{scale=1.2}
%		\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
%			\def\dscale{1}
%			\csvreader[head=false]{Q4/results/R2.csv}{}%
%			{%
%				\node[draw,circle,fill=black, inner sep=2pt,line width=.7] (????) at (\csvcoli*\dscale, \csvcolii*\dscale) {};%
%			}%
%			
%		\end{tikzpicture}
%	\end{adjustbox}
%	
	
\begin{figure}[h]
	\centering
	\begin{adjustbox}{scale=1.2}
		\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
			\def\dscale{300} % Set the scaling factor to 300
			\setcounter{rownum}{1} % Initialize the counter
			
			\coordinate (o) (0,0);		
			\csvreader[head=false]{Q4/results/R2.csv}{}%
			{%
				% Draw the node at the scaled position
				\node[draw, circle, fill=black, inner sep=2pt, line width=.7] 
				(\arabic{rownum}) at (\csvcoli*\dscale, \csvcolii*\dscale) {};
				
				% Add the row number above each node
				\node[above, gray] at (\arabic{rownum}) {\arabic{rownum}};
				\draw (o) -- (\arabic{rownum});
				\stepcounter{rownum} % Increment the counter after each row
			}%
			\let\rownum\relax
		\end{tikzpicture}
	\end{adjustbox}
	\caption{\space}
\end{figure}
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.5\linewidth]{Q4/results/array-beam-polar-R2}
		\caption{}
		\label{fig:array-beam-polar-r2}
	\end{figure}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=\linewidth]{Q4/results/array-beam-R2}
		\caption{}
		\label{fig:array-beam-r2}
	\end{figure}
	
	
	\FloatBarrier
	\subsection{part c:}
	
	
	
	\begin{equation}
		R_3 = (5 \times 10^{-3})
		\begin{bmatrix}
			3 + 0.5 \times \text{randn()} & 0 & 0 \\
			2 + 0.5 \times \text{randn()} & 0 & 0 \\
			1 + 0.5 \times \text{randn()} & 0 & 0 \\
			0 + 0.5 \times \text{randn()} & 0 & 0 \\
			-1 + 0.5 \times \text{randn()} & 0 & 0 \\
			-2 + 0.5 \times \text{randn()} & 0 & 0 \\
			-3 + 0.5 \times \text{randn()} & 0 & 0
		\end{bmatrix}
		= 
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/R3.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
	\end{equation}
	
	
		
	\begin{figure}[h]
		\centering
		\begin{adjustbox}{scale=1.2}
			\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
				\def\dscale{300} % Set the scaling factor to 300
				\setcounter{rownum}{1} % Initialize the counter
				\coordinate (o) (0,0);		
				\csvreader[head=false]{Q4/results/R3.csv}{}%
				{%
					% Draw the node at the scaled position
					\node[draw, circle, fill=black, inner sep=2pt, line width=.7] 
					(\arabic{rownum}) at (\csvcoli*\dscale, \csvcolii*\dscale) {};
					% Add the row number above each node
					\node[above, gray] at (\arabic{rownum}) {\arabic{rownum}};
					\draw (o) -- (\arabic{rownum});
					\stepcounter{rownum} % Increment the counter after each row
				}%
			\end{tikzpicture}
		\end{adjustbox}
		\caption{\space}
	\end{figure}
	
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.5\linewidth]{Q4/results/array-beam-polar-R3}
		\caption{}
		\label{fig:array-beam-polar-r3}
	\end{figure}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=\linewidth]{Q4/results/array-beam-R3}
		\caption{}
		\label{fig:array-beam-r3}
	\end{figure}
	
	
	
	\FloatBarrier
	\subsection{part d:}
	?????
	
	\begin{equation}
		R_3 = (5 \times 10^{-3})
		\begin{bmatrix}
			3 + 0.5 \times \text{randn()} & 0 & 0 \\
			2 + 0.5 \times \text{randn()} & 0 & 0 \\
			1 + 0.5 \times \text{randn()} & 0 & 0 \\
			0 + 0.5 \times \text{randn()} & 0 & 0 \\
			-1 + 0.5 \times \text{randn()} & 0 & 0 \\
			-2 + 0.5 \times \text{randn()} & 0 & 0 \\
			-3 + 0.5 \times \text{randn()} & 0 & 0
		\end{bmatrix}
		= 
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/R3-2.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
	\end{equation}
	
	
	
		\begin{figure}[h]
		\centering
		\begin{adjustbox}{scale=1.2}
			\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
				\def\dscale{300} % Set the scaling factor to 300
				\setcounter{rownum}{1} % Initialize the counter
				\coordinate (o) (0,0);		
				\csvreader[head=false]{Q4/results/R3-2.csv}{}%
				{%
					% Draw the node at the scaled position
					\node[draw, circle, fill=black, inner sep=2pt, line width=.7] 
					(\arabic{rownum}) at (\csvcoli*\dscale, \csvcolii*\dscale) {};
					% Add the row number above each node
					\node[above, gray] at (\arabic{rownum}) {\arabic{rownum}};
					\draw (o) -- (\arabic{rownum});
					\stepcounter{rownum} % Increment the counter after each row
				}%
			\end{tikzpicture}
		\end{adjustbox}
		\caption{\space}
	\end{figure}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.5\linewidth]{Q4/results/array-beam-polar-R3-2}
		\caption{}
		\label{fig:array-beam-polar-r3-2}
	\end{figure}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=\linewidth]{Q4/results/array-beam-R3-2}
		\caption{}
		\label{fig:array-beam-r3-2}
	\end{figure}
	
		
	\begin{table}[h]
		\centering
		\caption{Peak Optimization Results}
		\csvreader[
		head=false,
		tabular=|c|c|c|,
		table head=\hline \textbf{Maximum Peak} & \textbf{Max Side lobe's Peak} & \textbf{Peak Ratio} \\ \hline,
		late after line=\\\hline
		]{Q4/results/peak-R3-2.csv}{}%
		{%
			\csvcoli & \csvcolii & \csvcoliii
		}
	\end{table}
	
	
	
	
	\subsubsection{Method 1:}
	
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=\linewidth]{Q4/results/array-beam-Ropt}
		\caption{}
		\label{fig:array-beam-ropt}
	\end{figure}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.5\linewidth]{Q4/results/array-beam-polar-Ropt}
		\caption{}
		\label{fig:array-beam-polar-ropt}
	\end{figure}
	
	
	\begin{equation}
		R_{\text{opt}}
		= 
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/Ropt.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
		= R_2 + 
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/Ropt-R2.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
	\end{equation}
	
		
	\begin{figure}[H]
		\centering
		\begin{adjustbox}{scale=1.2}
			\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
				\def\dscale{300} % Set the scaling factor to 300
				\setcounter{rownum}{1} % Initialize the counter
				\coordinate (o) (0,0);		
				\csvreader[head=false]{Q4/results/Ropt.csv}{}%
				{%
					% Draw the node at the scaled position
					\node[draw, circle, fill=black, inner sep=2pt, line width=.7] 
					(\arabic{rownum}) at (\csvcoli*\dscale, \csvcolii*\dscale) {};
					% Add the row number above each node
					\node[above, gray] at (\arabic{rownum}) {\arabic{rownum}};
					\draw (o) -- (\arabic{rownum});
					\stepcounter{rownum} % Increment the counter after each row
				}%
			\end{tikzpicture}
		\end{adjustbox}
		\caption{\space}
	\end{figure}
	
		\begin{table}[h]
		\centering
		\caption{Peak Optimization Results}
		\csvreader[
		head=false,
		tabular=|c|c|c|,
		table head=\hline \textbf{Maximum Peak} & \textbf{Max Side lobe's Peak} & \textbf{Peak Ratio} \\ \hline,
		late after line=\\\hline
		]{Q4/results/peak-opt.csv}{}%
		{%
			\csvcoli & \csvcolii & \csvcoliii
		}
	\end{table}
	
	
	
	
	\subsubsection{Method 2:}
	
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=\linewidth]{Q4/results/array-beam-Ropt-2}
		\caption{}
		\label{fig:array-beam-ropt-2}
	\end{figure}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.5\linewidth]{Q4/results/array-beam-polar-Ropt-2}
		\caption{}
		\label{fig:array-beam-polar-ropt-2}
	\end{figure}
	
	
	\begin{equation}
		R_{\text{opt}}
		= 
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/Ropt-2.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
		= R_2 + 
		\begin{bmatrix}
			% Read the CSV file and insert the values into the matrix
			\csvreader[head=false, late after line=\\]{Q4/results/Ropt-R2-2.csv}{}%
			{\csvcoli & \csvcolii & \csvcoliii}
		\end{bmatrix}
	\end{equation}
	
	
	\begin{figure}[H]
		\centering
		\begin{adjustbox}{scale=1.2}
			\begin{tikzpicture}[scale=1, every node/.style={scale=1}]
				\def\dscale{300} % Set the scaling factor to 300
				\setcounter{rownum}{1} % Initialize the counter
				\coordinate (o) (0,0);		
				\csvreader[head=false]{Q4/results/Ropt-2.csv}{}%
				{%
					% Draw the node at the scaled position
					\node[draw, circle, fill=black, inner sep=2pt, line width=.7] 
					(\arabic{rownum}) at (\csvcoli*\dscale, \csvcolii*\dscale) {};
					% Add the row number above each node
					\node[above, gray] at (\arabic{rownum}) {\arabic{rownum}};
					\draw (o) -- (\arabic{rownum});
					\stepcounter{rownum} % Increment the counter after each row
				}%
			\end{tikzpicture}
		\end{adjustbox}
		\caption{\space}
	\end{figure}
	
	
	\begin{table}[h]
		\centering
		\caption{Peak Optimization Results}
		\csvreader[
		head=false,
		tabular=|c|c|c|,
		table head=\hline \textbf{Maximum Peak} & \textbf{Max Side lobe's Peak} & \textbf{Peak Ratio} \\ \hline,
		late after line=\\\hline
		]{Q4/results/peak-opt-2.csv}{}%
		{%
			\csvcoli & \csvcolii & \csvcoliii
		}
	\end{table}
	
	
	
	\FloatBarrier
	\subsubsection{Comparing these two methods:}
	
		
		\begin{table}[h]
			\centering
			\caption{Merged Peak Optimization Results}
			\begin{tabular}{cccc}
				\toprule
				\textbf{Method} &
				\textbf{Maximum Peak} & \textbf{Max Side lobe's Peak} & \textbf{Peak Ratio} \\
				\midrule
				Method 1 &
				% First CSV file
				\csvreader[head=false, late after line=\\]{Q4/results/peak-opt.csv}{}%
				{%
					\csvcoli & \csvcolii & \csvcoliii
				}
				Method 2 &
				% Second CSV file
				\csvreader[head=false, late after line=\\]{Q4/results/peak-opt-2.csv}{}%
				{%
					\csvcoli & \csvcolii & \csvcoliii
				}
				\bottomrule
			\end{tabular}
		\end{table}
		

	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\FloatBarrier
	\question%5
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\FloatBarrier
	\question%6
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\newpage
	\bibliographystyle{plainnat}
	%\nocite{*}
	\bibliography{references}
	
\end{document}